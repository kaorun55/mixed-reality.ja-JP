---
title: 空間アンカー
description: 安定したホログラムをレンダリングするために空間アンカーを使用するためのベスト プラクティス。
author: thetuvix
ms.author: alexturn
ms.date: 02/24/2019
ms.topic: article
keywords: 座標系、空間座標系、ワールドスケール、ワールド、スケール、位置、向き、アンカー、空間アンカー、ワールドロック済み、ワールドロック、永続化、共有
ms.openlocfilehash: f65cf582db43399814737d581ece4694646a144c
ms.sourcegitcommit: 6bc6757b9b273a63f260f1716c944603dfa51151
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/01/2019
ms.locfileid: "73438029"
---
# <a name="spatial-anchors"></a>空間アンカー

空間アンカーは、システムによって時間の経過と共に追跡される、世界中の重要なポイントを表します。 アンカーで固定されたホログラムを正確に固定するため、各アンカーには、必要に応じて他のアンカーや座標系に対して調整される[座標系](coordinate-systems.md)があります。  アンカーの座標系でホログラムをレンダリングすると、ホログラムの位置は常に最も正確なものになります。 これは、システムが実際の世界を基準にして継続的に移動するときに、ホログラムの位置に対して時間の経過に伴う微調整のコストを発生させます。

また、アプリケーションセッション間およびデバイス間で空間アンカーを永続化して共有することもできます。
* ローカル空間アンカーをディスクに保存し、後で読み込むことによって、アプリケーションは、単一の HoloLens 上の複数のアプリケーションセッションで、実際の環境内の同じ場所を計算できます。
* <a href="https://docs.microsoft.com/azure/spatial-anchors/overview" target="_blank">Azure 空間アンカー</a>を使用してクラウドアンカーを作成することにより、アプリケーションは複数の HoloLens、iOS、および Android デバイス間で空間アンカーを共有できます。 各デバイスで同じ空間アンカーを使用してホログラムをレンダリングすることにより、ユーザーには、そのホログラムが現実世界の同じ場所に表示されることがわかります。 これにより、リアルタイム共有エクスペリエンスを実現できます。
* <a href="https://docs.microsoft.com/azure/spatial-anchors/overview" target="_blank">Azure 空間アンカー</a>を使用して HoloLens、iOS および Android デバイスの間で非同期ホログラム永続化を行うこともできます。 永続的なクラウド空間アンカーを共有すると、永続化した同じホログラムを長時間にわたって複数のデバイスに表示できます。これらのデバイスが同じ時間と場所に居合わせていなくても問題ありません。

5メートルの直径内に収まるテザリングさデスクトップヘッドセットのための、継続的なスケールまたはルームスケールのエクスペリエンスについては、通常、空間アンカーではなく、[参照のステージフレーム](coordinate-systems.md#stage-frame-of-reference)を使用します。これにより、1つの座標系がすべてのコンテンツを表示します。 ただし、アプリケーションで、ユーザーが HoloLens で5メートルを超えている場合、たとえばビルのフロア全体で動作するようにする場合は、コンテンツを安定した状態に保つために空間アンカーが必要になります。

空間アンカーは、世界の中に固定するホログラムに適しています。空間アンカーは、一度配置すると移動させることはできません。 アンカーの代替手段として、ユーザーとタグを付ける動的ホログラムに適しています。 動的ホログラムは、静止基準系 (Unity のワールド座標系の土台) または接続座標系を使用して配置することをお勧めします。

## <a name="best-practices"></a>ベスト プラクティス

以下の空間アンカー ガイドラインを使用すると、現実世界を正確に追跡する安定したホログラムをレンダリングできます。

### <a name="create-spatial-anchors-where-users-place-them"></a>空間アンカーはユーザーが配置した場所に作成する

通常、ユーザーは空間アンカーを明示的に配置しています。

たとえば、HoloLens では、アプリケーションはユーザーの[宝石](gaze-and-commit.md)と[空間マッピング](spatial-mapping.md)メッシュを交差させて、ユーザーがホログラムをどこに配置するかを決定できるようにすることができます。 ユーザーがタップしてそのホログラムを配置したら、交差点に空間アンカーを作成し、そのアンカーの座標系の原点にホログラムを配置します。

ローカル空間アンカーは、簡単かつ高性能に作成できます。 複数のアンカーが基になるセンサーデータを共有できる場合、システムは内部データを統合します。 通常は、ユーザーが明示的に配置した各ホログラムに対して、新しいローカル空間アンカーを作成する必要があります。ただし、ホログラムの固定グループなど、以下に示すケースは除きます。

### <a name="always-render-anchored-holograms-within-3-meters-of-their-anchor"></a>固定されたホログラムは必ずアンカーから 3 m にレンダリングする

空間アンカーは、アンカーの原点近くの座標系を安定させます。 このオリジンから3メートルを超えるホログラムをレンダリングした場合、それらのホログラムは、レバー arm の効果に起因して、その原点からの距離に比例して顕著な位置指定エラーを発生させる可能性があります。 これは、ユーザーがアンカーの近くにある場合に機能します。これは、ホログラムがユーザーから離れた場所にあるためです。 言い換えると、遠くのホログラムの角誤差は小さくなります。 ただし、ユーザーが遠くのホログラムについての説明を見ると、それが大きくなり、遠隔地アンカーの原点からのレバー arm の効果が非常に明確になります。

### <a name="group-holograms-that-should-form-a-rigid-cluster"></a>剛体クラスターを形成すべきグループ ホログラム

アプリケーションで固定関係を維持するために、複数のホログラムは同じ空間アンカーを共有できます。

たとえば、部屋で holographic 太陽システムをアニメーション化する場合は、すべての太陽システムオブジェクトを中央の1つのアンカーに関連付けて、互いに滑らかに移動させることをお勧めします。 この場合、太陽系の個々の構成要素が直接アンカーの周囲を移動しますが、太陽系全体をアンカーで固定します。

ホログラムの安定性を維持するための重要な注意事項は、上記の3メートルの規則に従うことです。

### <a name="render-highly-dynamic-holograms-using-the-stationary-frame-of-reference-instead-of-a-local-spatial-anchor"></a>ローカルの空間アンカーの代わりに静止基準系を使用して非常に動的なホログラムをレンダリングする

部屋を囲む文字や、ユーザーの近くの壁に沿ったフローティング UI など、高度に動的なホログラムがある場合は、ローカル空間アンカーをスキップし、次の[ように指定された座標系でそれらのホログラムを直接レンダリングすることをお勧めします。静止した参照フレーム](coordinate-systems.md#stationary-frame-of-reference)。 私は、WorldAnchor を使用せずに、ワールド座標にホログラムを直接配置することによってこれを実現しています。 静止した参照フレーム内のホログラムは、ユーザーがホログラムから離れていると、ずれを感じることがあります。 ただし、動的なホログラムの場合、これはあまり顕著ではありません。ホログラムが常に移動されるか、またはそのモーションによって、誤差が最小化されるユーザーに近い状態を維持することができます。

動的ホログラムにおける興味深いケースとして、ある固定の座標系から別の座標系にアニメーションするオブジェクトがあげられます。 たとえば、城10の2つのメーターがあるとします。それぞれが独自の空間アンカーにあり、もう一方の城では、1つの城主がある城以外のボールを起動します。 Cannonball が起動されると、最初の城の固定された座標系でキャノンと一致するように、参照フレーム内の適切な位置にレンダリングできるようになります。 その後、静止基準系にある弾道をたどって弾を 10 m 飛ばします。 Cannonball が他の城に達したときは、2番目の城の固定された座標系に移動して、その城の固定の本体で物理的な計算を行うことができます。

デバイス間で高度に動的なホログラムを共有している場合は、一部のクラウド空間アンカーを選択して親として機能させる必要があります。これは、複数のデバイスで参照の静止フレームを共有できないためです。  ただし、この場合、すべてのデバイスでホログラムが安定して表示されるように、動的なホログラムまたはそれを表示しているデバイスがアンカーの3測定半径の範囲内にあることを確認する必要があります。

### <a name="avoid-creating-a-grid-of-spatial-anchors"></a>空間アンカーのグリッドを作成しない

場合によっては、ユーザーが移動するときに空間アンカーの通常のグリッドをドロップして、アンカーからアンカーに動的オブジェクトを移行することが必要になることがあります。 ただし、これには、システム自体によって内部的に管理される詳細センサーデータを利用することなく、アプリケーションの管理が多数必要になります。 このような場合、通常は、前のセクションで説明したように、ホログラムを参照の静止フレームに配置することで、より良い結果を得ることができます。
静的な空間に対して一連のクラウド空間アンカーを事前に配置する場合は、アンカーの任意のグリッドを作成するのではなく、前述の原則に従って、ユーザーが検出したキーホログラムの位置に空間アンカーを配置することを検討してください。 これにより、重要なホログラムを最大限に安定させることができます。

### <a name="release-local-spatial-anchors-you-no-longer-need"></a>不要になったローカル空間アンカーをリリースする

ローカル空間アンカーがアクティブになっている間、システムはそのアンカーの近くにあるセンサーデータを保持します。 空間のアンカーを使わなくなった場合、その座標系にアクセスしないようにします。 これにより、基になるセンサーデータを必要に応じて削除できます。

これは、空間アンカー ストアに永続化させたローカル アンカーにとって特に重要です。 これらのアンカーの背後にあるセンサーデータは、アプリケーションが将来のセッションでアンカーを見つけることができるように永続的に保持されます。これにより、他のアンカーを追跡するために使用できる領域が減少します。 将来のセッションで再び検索する必要があるローカルアンカーだけを保持し、ユーザーにとって意味がなくなったときにストアから削除します。

クラウド空間のアンカーのストレージは、シナリオで必要とされるだけ拡張することができます。 必要に応じていくつでもクラウドアンカーを格納できます。その場合、ユーザーがそのアンカーでホログラムを検索する必要がないことがわかっている場合にのみ、それらを解放します。

## <a name="see-also"></a>関連項目
* [座標系](coordinate-systems.md)
* [複合現実での共有エクスペリエンス](shared-experiences-in-mixed-reality.md)
* <a href="https://docs.microsoft.com/azure/spatial-anchors" target="_blank">Azure Spatial Anchors</a>
* [Unity の永続化](persistence-in-unity.md)
* [DirectX の空間アンカー](coordinate-systems-in-directx.md#place-holograms-in-the-world-using-spatial-anchors)
* [ケース スタディ - Mixed Reality で穴から覗く](case-study-looking-through-holes-in-your-reality.md)
